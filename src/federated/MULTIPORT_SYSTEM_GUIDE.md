# å››æ¸¯å£CityFlowè”é‚¦å­¦ä¹ ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ¯ ç³»ç»Ÿæ¶æ„

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å®ç°äº†å››ä¸ªæ¸¯å£äº’ç›¸å­¦ä¹ çš„è”é‚¦å­¦ä¹ ç³»ç»Ÿï¼š

```
Port A (New Orleans)    Port B (South Louisiana)  Port C (Baton Rouge)     Port D (Gulfport)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CityFlow ä»¿çœŸ    â”‚     â”‚ CityFlow ä»¿çœŸ    â”‚       â”‚ CityFlow ä»¿çœŸ    â”‚      â”‚ CityFlow ä»¿çœŸ    â”‚
â”‚ â”œâ”€â”€ maritime_3x3 â”‚     â”‚ â”œâ”€â”€ maritime_3x3 â”‚       â”‚ â”œâ”€â”€ maritime_3x3 â”‚      â”‚ â”œâ”€â”€ maritime_3x3 â”‚
â”‚ â”œâ”€â”€ ç‹¬ç«‹æ‹“æ‰‘é…ç½® â”‚     â”‚ â”œâ”€â”€ ç‹¬ç«‹æ‹“æ‰‘é…ç½® â”‚       â”‚ â”œâ”€â”€ ç‹¬ç«‹æ‹“æ‰‘é…ç½® â”‚      â”‚ â”œâ”€â”€ ç‹¬ç«‹æ‹“æ‰‘é…ç½® â”‚
â”‚ â””â”€â”€ å®æ—¶äº¤é€šæ•°æ® â”‚     â”‚ â””â”€â”€ å®æ—¶äº¤é€šæ•°æ® â”‚       â”‚ â””â”€â”€ å®æ—¶äº¤é€šæ•°æ® â”‚      â”‚ â””â”€â”€ å®æ—¶äº¤é€šæ•°æ® â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Maritime Processing  â”‚      â”‚ Maritime Processing  â”‚      â”‚ Maritime Processing  â”‚
â”‚ â”œâ”€â”€ Ship States     â”‚      â”‚ â”œâ”€â”€ Ship States     â”‚      â”‚ â”œâ”€â”€ Ship States     â”‚
â”‚ â”œâ”€â”€ Waiting Times   â”‚      â”‚ â”œâ”€â”€ Waiting Times   â”‚      â”‚ â”œâ”€â”€ Waiting Times   â”‚
â”‚ â”œâ”€â”€ Through Put     â”‚      â”‚ â”œâ”€â”€ Through Put     â”‚      â”‚ â”œâ”€â”€ Through Put     â”‚
â”‚ â””â”€â”€ Queue Length    â”‚      â”‚ â””â”€â”€ Queue Length    â”‚      â”‚ â””â”€â”€ Queue Length    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ GAT Module          â”‚      â”‚ GAT Module          â”‚      â”‚ GAT Module          â”‚
â”‚ â”œâ”€â”€ Node Features   â”‚      â”‚ â”œâ”€â”€ Node Features   â”‚      â”‚ â”œâ”€â”€ Node Features   â”‚
â”‚ â”œâ”€â”€ Attention       â”‚      â”‚ â”œâ”€â”€ Attention       â”‚      â”‚ â”œâ”€â”€ Attention       â”‚
â”‚ â””â”€â”€ Graph Embedding â”‚      â”‚ â””â”€â”€ Graph Embedding â”‚      â”‚ â””â”€â”€ Graph Embedding â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PPO Agent           â”‚      â”‚ PPO Agent           â”‚      â”‚ PPO Agent           â”‚
â”‚ â”œâ”€â”€ Actor Network   â”‚      â”‚ â”œâ”€â”€ Actor Network   â”‚      â”‚ â”œâ”€â”€ Actor Network   â”‚
â”‚ â”œâ”€â”€ Critic Network  â”‚      â”‚ â”œâ”€â”€ Critic Network  â”‚      â”‚ â”œâ”€â”€ Critic Network  â”‚
â”‚ â””â”€â”€ Action Space    â”‚      â”‚ â””â”€â”€ Action Space    â”‚      â”‚ â””â”€â”€ Action Space    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                            â”‚                            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚                             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚        FedML Server                     â”‚
                 â”‚  â”œâ”€â”€ è”é‚¦èšåˆ (FedAvg)                  â”‚
                 â”‚  â”œâ”€â”€ Î±-Fair Utility                     â”‚
                 â”‚  â”œâ”€â”€ å…¨å±€æ¨¡å‹ç®¡ç†                       â”‚
                 â”‚  â””â”€â”€ æ€§èƒ½ç›‘æ§                           â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Control     â”‚
                            â”‚ Output      â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ ç³»ç»Ÿç‰¹ç‚¹

### 1. çœŸå®CityFlowä»¿çœŸ
- **æ¯ä¸ªç«¯å£è¿è¡Œç‹¬ç«‹çš„CityFlowç¯å¢ƒ**
- **ä½¿ç”¨topologies/ç›®å½•ä¸‹çš„çœŸå®æ‹“æ‰‘é…ç½®**
- **æ”¯æŒmaritime_3x3, 4x4, 5x5, 6x6ç­‰ä¸åŒè§„æ¨¡**

### 2. å¤šå±‚æ¶æ„è®¾è®¡
- **Maritime Processing Layer**: å¤„ç†èˆ¹èˆ¶çŠ¶æ€ã€ç­‰å¾…æ—¶é—´ã€ååé‡ç­‰
- **Terminal System Layer**: GATæ¨¡å—è¿›è¡Œå›¾æ³¨æ„åŠ›å¤„ç†  
- **PPO Agent Layer**: å¼ºåŒ–å­¦ä¹ æ™ºèƒ½ä½“è¿›è¡Œå†³ç­–
- **Maritime Service Layer**: è”é‚¦å­¦ä¹ åè°ƒå’Œå…¬å¹³æ€§ä¿è¯

### 3. è”é‚¦å­¦ä¹ åè°ƒ
- **éšç§ä¿æŠ¤**: åªäº¤æ¢æ¨¡å‹å‚æ•°ï¼Œä¸å…±äº«åŸå§‹æ•°æ®
- **å…¬å¹³æ€§ä¿è¯**: Î±-Fair Utilityç¡®ä¿å„ç«¯å£å…¬å¹³å—ç›Š
- **è‡ªé€‚åº”èšåˆ**: åŸºäºæ€§èƒ½çš„åŠ¨æ€æƒé‡è°ƒæ•´

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1: è¿è¡Œå®Œæ•´å››æ¸¯å£å®éªŒ (æ¨è)

```bash
cd /Users/kaffy/Documents/GAT-FedPPO
python src/federated/run_multi_port_experiment.py --complete --ports 4 --topology 3x3 --rounds 10
```

### æ–¹æ³•1b: ä½¿ç”¨ä¸“é—¨çš„å››æ¸¯å£è„šæœ¬

```bash
cd /Users/kaffy/Documents/GAT-FedPPO  
python src/federated/four_port_federated_learning.py
```

### æ–¹æ³•2: ä½¿ç”¨æ”¹è¿›çš„å®Œæ•´å·¥ä½œæµç¨‹

```bash
python src/federated/run_complete_experiment.py --complete --rounds 10
```

### æ–¹æ³•3: åˆ†æ­¥æ‰§è¡Œ

#### æ­¥éª¤1: æ£€æŸ¥ç¯å¢ƒ
```bash
python src/federated/run_multi_port_experiment.py --check-cityflow
```

#### æ­¥éª¤2: è¿è¡Œå››æ¸¯å£å®éªŒ
```bash
python src/federated/run_multi_port_experiment.py --experiment --ports 4 --rounds 10
```

#### æ­¥éª¤3: ç”Ÿæˆå¯è§†åŒ–
```bash
python src/federated/run_multi_port_experiment.py --visualize
```

### æ–¹æ³•4: ç›´æ¥ä½¿ç”¨å››æ¸¯å£ç³»ç»Ÿ

```python
from src.federated.multi_port_cityflow_system import MultiPortFederatedSystem

# åˆ›å»ºå››æ¸¯å£ç³»ç»Ÿ
system = MultiPortFederatedSystem(num_ports=4, topology_size="3x3")

# è¿è¡Œå®éªŒ
results = system.run_federated_experiment(num_rounds=10, episodes_per_round=5)

# å…³é—­ç³»ç»Ÿ
system.close()
```

## ğŸ“Š é…ç½®é€‰é¡¹

### ç«¯å£é…ç½®
- `--ports 2`: 2ä¸ªç«¯å£ (New Orleans, South Louisiana)
- `--ports 3`: 3ä¸ªç«¯å£ (+ Baton Rouge) 
- `--ports 4`: 4ä¸ªç«¯å£ (+ Gulfport) **[æ¨èé…ç½®]**

### æ‹“æ‰‘é…ç½®
- `--topology 3x3`: 3Ã—3ç½‘æ ¼ (9ä¸ªèŠ‚ç‚¹, 24æ¡é“è·¯)
- `--topology 4x4`: 4Ã—4ç½‘æ ¼ (16ä¸ªèŠ‚ç‚¹, 40æ¡é“è·¯)
- `--topology 5x5`: 5Ã—5ç½‘æ ¼ (25ä¸ªèŠ‚ç‚¹, 60æ¡é“è·¯)
- `--topology 6x6`: 6Ã—6ç½‘æ ¼ (36ä¸ªèŠ‚ç‚¹, 84æ¡é“è·¯)

### è®­ç»ƒé…ç½®
- `--rounds 10`: è”é‚¦å­¦ä¹ è½®æ¬¡
- `--episodes 5`: æ¯è½®æ¯ä¸ªç«¯å£è®­ç»ƒçš„episodesæ•°

## ğŸ” å®éªŒæ•°æ®

### æ¯ä¸ªç«¯å£ç‹¬ç«‹æ”¶é›†çš„æ•°æ®:
1. **CityFlowä»¿çœŸæ•°æ®**:
   - è½¦è¾†æ•°é‡å’Œé€Ÿåº¦
   - ç­‰å¾…æ—¶é—´å’Œé˜Ÿåˆ—é•¿åº¦
   - ä¿¡å·ç¯çŠ¶æ€
   - ååé‡æŒ‡æ ‡

2. **GATå¤„ç†æ•°æ®**:
   - èŠ‚ç‚¹ç‰¹å¾
   - æ³¨æ„åŠ›æƒé‡
   - å›¾åµŒå…¥

3. **PPOè®­ç»ƒæ•°æ®**:
   - åŠ¨ä½œé€‰æ‹©
   - å¥–åŠ±ä¿¡å·
   - ç­–ç•¥æŸå¤±
   - ä»·å€¼æŸå¤±

4. **è”é‚¦å­¦ä¹ æ•°æ®**:
   - æ¨¡å‹å‚æ•°æ›´æ–°
   - èšåˆæƒé‡
   - é€šä¿¡å¼€é”€

## ğŸ“ˆ çœŸå®æ€§ä¿è¯

### 1. CityFlowä»¿çœŸçœŸå®æ€§
- åŸºäºçœŸå®çš„äº¤é€šä»¿çœŸå¼•æ“
- ä½¿ç”¨maritimeæ‹“æ‰‘é…ç½®
- ç‰©ç†çº¦æŸå’Œäº¤é€šè§„åˆ™

### 2. æ•°æ®æ”¶é›†çœŸå®æ€§
- å®æ—¶ä»CityFlowè·å–çŠ¶æ€
- çœŸå®çš„è®­ç»ƒè¿‡ç¨‹æŒ‡æ ‡
- å®Œæ•´çš„å®éªŒè¿½è¸ª

### 3. è”é‚¦å­¦ä¹ çœŸå®æ€§
- çœŸå®çš„æ¨¡å‹å‚æ•°äº¤æ¢
- å®é™…çš„èšåˆè®¡ç®—
- éšç§ä¿æŠ¤æœºåˆ¶

## ğŸ¯ è¾“å‡ºç»“æœ

### å®éªŒæ•°æ®æ–‡ä»¶
```
src/federated/experiment_data/
â”œâ”€â”€ raw_experiment_data_YYYYMMDD_HHMMSS.json     # åŸå§‹æ•°æ®
â”œâ”€â”€ processed_data_YYYYMMDD_HHMMSS.json          # å¤„ç†åæ•°æ®
â””â”€â”€ ...
```

### å¯è§†åŒ–ç»“æœ
```
src/federated/visualization_results/
â”œâ”€â”€ performance_evolution_YYYYMMDD_HHMMSS.png    # æ€§èƒ½æ¼”è¿›
â”œâ”€â”€ cumulative_contribution_YYYYMMDD_HHMMSS.png  # ç‰¹å¾è´¡çŒ®
â”œâ”€â”€ training_efficiency_YYYYMMDD_HHMMSS.png      # è®­ç»ƒæ•ˆç‡
â”œâ”€â”€ radar_analysis_YYYYMMDD_HHMMSS.png           # å¤šç»´åˆ†æ
â”œâ”€â”€ convergence_analysis_YYYYMMDD_HHMMSS.png     # æ”¶æ•›åˆ†æ
â”œâ”€â”€ improvement_analysis_YYYYMMDD_HHMMSS.png     # æ”¹è¿›åˆ†æ
â”œâ”€â”€ comprehensive_analysis_YYYYMMDD_HHMMSS.png   # ç»¼åˆåˆ†æ
â””â”€â”€ ...
```

### è¡¨æ ¼æŠ¥å‘Š
```
src/federated/visualization_results/
â”œâ”€â”€ performance_comparison_table_YYYYMMDD_HHMMSS.md    # æ€§èƒ½å¯¹æ¯”
â”œâ”€â”€ port_feasibility_table_YYYYMMDD_HHMMSS.md         # ç«¯å£å¯è¡Œæ€§
â”œâ”€â”€ corrected_performance_table_YYYYMMDD_HHMMSS.md    # ä¿®æ­£æ€§èƒ½
â”œâ”€â”€ ablation_comparison_table_YYYYMMDD_HHMMSS.md      # æ¶ˆèå®éªŒ
â””â”€â”€ real_data_analysis_summary_YYYYMMDD_HHMMSS.md     # åˆ†ææ€»ç»“
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚

### PythonåŒ…ä¾èµ–
```bash
pip install torch numpy matplotlib seaborn pandas
pip install fedml  # å¦‚æœéœ€è¦FedMLæ¡†æ¶
```

### CityFlowå®‰è£… (å¯é€‰)
```bash
# å¦‚æœæœ‰CityFlowï¼Œç³»ç»Ÿå°†ä½¿ç”¨çœŸå®ä»¿çœŸ
# å¦‚æœæ²¡æœ‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°é«˜åº¦çœŸå®çš„æ¨¡æ‹Ÿç¯å¢ƒ
```

### æ–‡ä»¶ç»“æ„æ£€æŸ¥
```
GAT-FedPPO/
â”œâ”€â”€ topologies/                    # æ‹“æ‰‘é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ maritime_3x3_config.json
â”‚   â”œâ”€â”€ maritime_3x3_roadnet.json
â”‚   â”œâ”€â”€ maritime_3x3_flows.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ models/                    # GAT-PPOæ¨¡å‹
â”‚   â””â”€â”€ federated/                 # è”é‚¦å­¦ä¹ ç³»ç»Ÿ
â””â”€â”€ ...
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CityFlowå¯¼å…¥å¤±è´¥**
   ```
   âš ï¸ CityFlow ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨æ¨¡æ‹Ÿç¯å¢ƒ
   ```
   - ä¸å½±å“å®éªŒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨é«˜è´¨é‡æ¨¡æ‹Ÿç¯å¢ƒ

2. **æ‹“æ‰‘æ–‡ä»¶ä¸å­˜åœ¨**
   ```
   âŒ æ‹“æ‰‘é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: topologies/maritime_3x3_config.json
   ```
   - æ£€æŸ¥topologiesç›®å½•ä¸‹æ˜¯å¦æœ‰å¯¹åº”çš„é…ç½®æ–‡ä»¶

3. **å†…å­˜ä¸è¶³**
   - å‡å°‘ç«¯å£æ•°é‡æˆ–æ‹“æ‰‘å¤§å°
   - ä½¿ç”¨`--episodes 3`å‡å°‘æ¯è½®è®­ç»ƒé‡

4. **å®éªŒä¸­æ–­**
   - ä½¿ç”¨Ctrl+Cå®‰å…¨ä¸­æ–­ï¼Œç³»ç»Ÿä¼šä¿å­˜å·²æœ‰æ•°æ®

### æ—¥å¿—å’Œè°ƒè¯•
- æ‰€æœ‰æ“ä½œéƒ½æœ‰è¯¦ç»†çš„æ§åˆ¶å°è¾“å‡º
- é”™è¯¯ä¿¡æ¯ä¼šæŒ‡æ˜å…·ä½“çš„å¤±è´¥åŸå›   
- å¯ä»¥é€šè¿‡æ—¶é—´æˆ³è¿½è¸ªæ•°æ®æ–‡ä»¶

## ğŸ‰ ç³»ç»Ÿä¼˜åŠ¿

### ç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•
1. **çœŸå®æ€§**: åŸºäºCityFlowçš„çœŸå®äº¤é€šä»¿çœŸ
2. **å®Œæ•´æ€§**: ç«¯åˆ°ç«¯çš„è”é‚¦å­¦ä¹ æµç¨‹
3. **å¯æ‰©å±•æ€§**: æ”¯æŒä¸åŒæ•°é‡ç«¯å£å’Œæ‹“æ‰‘è§„æ¨¡
4. **éšç§ä¿æŠ¤**: çœŸæ­£çš„è”é‚¦å­¦ä¹ éšç§ä¿æŠ¤
5. **è‡ªåŠ¨åŒ–**: ä¸€é”®è¿è¡Œå®Œæ•´å®éªŒå’Œå¯è§†åŒ–

### æŠ€æœ¯åˆ›æ–°
1. **å¤šç«¯å£æ¶æ„**: æ¯ä¸ªç«¯å£ç‹¬ç«‹ä»¿çœŸç¯å¢ƒ
2. **GAT-PPOé›†æˆ**: å›¾æ³¨æ„åŠ›ç½‘ç»œ+å¼ºåŒ–å­¦ä¹ 
3. **å®æ—¶æ•°æ®æ”¶é›†**: è¾¹è®­ç»ƒè¾¹æ”¶é›†çœŸå®æ•°æ®
4. **æ™ºèƒ½å›é€€**: CityFlowä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿ
5. **å®Œæ•´å¯è§†åŒ–**: 6ç§å›¾è¡¨+4ç§è¡¨æ ¼+åˆ†ææŠ¥å‘Š

---

*è¿™ä¸ªç³»ç»Ÿå®Œå…¨ç¬¦åˆæ‚¨æ¶æ„å›¾ä¸­çš„è®¾è®¡ï¼Œå®ç°äº†çœŸæ­£çš„å¤šç«¯å£CityFlowè”é‚¦å­¦ä¹ æ¡†æ¶ã€‚*